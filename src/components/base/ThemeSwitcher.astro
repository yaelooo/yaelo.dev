---
import Sun from "@icons/Sun.astro";
import Moon from "@icons/Moon.astro";
---

<button id="sun" role="button" class="hidden" onclick="themeSwitch()">
  <Sun class="fill-yellow-400" />
  <span class="sr-only">Cambiar a tema oscuro</span>
</button>

<button id="moon" role="button" class="hidden" onclick="themeSwitch()">
  <Moon class="fill-indigo-900" />
  <span class="sr-only">Cambiar a tema claro</span>
</button>

<script is:inline>
  window.themeSwitch = function () {
    const rootClassList = document.documentElement.classList;
    const isDark = rootClassList.contains("dark");
    const newTheme = isDark ? "light" : "dark";
    rootClassList.replace(isDark ? "dark" : "light", newTheme);
    const activeIcon = document.querySelector(isDark ? "#moon" : "#sun");
    const inactiveIcon = document.querySelector(isDark ? "#sun" : "#moon");
    activeIcon.classList.replace("flex", "hidden");
    inactiveIcon.classList.replace("hidden", "flex");
    localStorage.setItem("theme", newTheme);
  };

  document.addEventListener("astro:page-load", () => {
    const rootClassList = document.documentElement.classList;
    const userTheme = localStorage.getItem("theme");
    const systemTheme = window.matchMedia(
      "(prefers-color-scheme: dark)"
    ).matches;
    const isDark = userTheme === "dark" || (!userTheme && systemTheme);
    const newTheme = isDark ? "dark" : "light";
    rootClassList.add(newTheme);
    const activeIcon = document.querySelector(isDark ? "#moon" : "#sun");
    const inactiveIcon = document.querySelector(isDark ? "#sun" : "#moon");
    activeIcon.classList.replace("hidden", "flex");
    inactiveIcon.classList.replace("flex", "hidden");
  });
</script>

<script>
  document.addEventListener("astro:after-swap", () => {
    localStorage.theme === "dark"
      ? document.documentElement.classList.add("dark")
      : document.documentElement.classList.add("light");
  });
</script>
