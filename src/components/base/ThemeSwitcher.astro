---
import Sun from "@icons/Sun.astro";
import Moon from "@icons/Moon.astro";
---

<button id="sun" role="button" class="hidden" onclick="themeSwitch()">
  <Sun class="fill-yellow-400" />
  <span class="sr-only">Cambiar a tema oscuro</span>
</button>

<button id="moon" role="button" class="hidden" onclick="themeSwitch()">
  <Moon class="fill-indigo-900" />
  <span class="sr-only">Cambiar a tema claro</span>
</button>

<script is:inline>
  const userTheme = localStorage.getItem("theme");
  const systemTheme = window.matchMedia("(prefers-color-scheme: dark)").matches;
  const rootClassList = document.documentElement.classList;
  const moonIcon = document.querySelector("#moon");
  const sunIcon = document.querySelector("#sun");

  function themeCheck() {
    const theme =
      userTheme === "dark" || (!userTheme && systemTheme) ? "dark" : "light";
    rootClassList.add(theme);
    (theme === "dark" ? moonIcon : sunIcon).classList.replace("hidden", "flex");
  }

  themeCheck();

  function themeSwitch() {
    const isDark = rootClassList.contains("dark");
    const newTheme = isDark ? "light" : "dark";
    rootClassList.replace(isDark ? "dark" : "light", newTheme);
    (isDark ? moonIcon : sunIcon).classList.replace("flex", "hidden");
    (isDark ? sunIcon : moonIcon).classList.replace("hidden", "flex");
    localStorage.setItem("theme", newTheme);
  }
</script>
